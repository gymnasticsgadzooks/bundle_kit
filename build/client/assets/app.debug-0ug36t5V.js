import{j as s}from"./index-BXFZJKZ8.js";import{u as k}from"./components-B2MXwJ-S.js";import{P as D,B as a,C as t,I as u,T as n,c as r,b as C,d}from"./Page-D9pdNdHS.js";import{T as w}from"./TitleBar-DFMSJ8Yc.js";import{B as g}from"./Banner-BiM8hRvP.js";import"./context-BusKBsRw.js";import"./banner-context-RZ1829w2.js";function H(){var h,p,x;const{shop:m,allFunctions:o,diagnostics:b,envFunctionId:S,shopConfig:f,consolidatedNode:i,consolidatedIssues:l}=k(),y=()=>{const e=document.createElement("form");e.method="post",document.body.appendChild(e),e.submit()};return s.jsxs(D,{title:"Bundle Diagnostics",children:[s.jsx(w,{title:"Bundle Diagnostics"}),s.jsxs(a,{gap:"500",children:[s.jsx(t,{children:s.jsxs(a,{gap:"300",children:[s.jsxs(u,{gap:"300",align:"start",children:[s.jsx(n,{variant:"headingMd",as:"h2",children:"Consolidated Discount Node"}),l.length===0?s.jsx(r,{tone:"success",children:"HEALTHY"}):s.jsx(r,{tone:"critical",children:"BROKEN"})]}),s.jsxs(n,{as:"p",children:[s.jsx("strong",{children:"ShopConfig.consolidatedNodeId:"})," ",f.consolidatedNodeId??"(null — not created yet)"]}),i&&s.jsxs(s.Fragment,{children:[s.jsxs(n,{as:"p",children:[s.jsx("strong",{children:"Status:"})," ",(h=i==null?void 0:i.discount)==null?void 0:h.status]}),s.jsxs(n,{as:"p",children:[s.jsx("strong",{children:"Discount Classes:"})," ",JSON.stringify((p=i==null?void 0:i.discount)==null?void 0:p.discountClasses)]}),s.jsxs(n,{as:"p",children:[s.jsx("strong",{children:"Metafield present:"})," ",(x=i==null?void 0:i.metafield)!=null&&x.value?`Yes (${i.metafield.value.length} chars)`:"No"]})]}),l.length>0&&s.jsx(g,{tone:"critical",title:"Issues Found",children:s.jsx(a,{gap:"100",children:l.map((e,j)=>s.jsx(n,{as:"p",children:e},j))})}),s.jsx(C,{variant:"primary",onClick:y,children:"Re-sync Discount Nodes Now"})]})}),s.jsx(t,{children:s.jsxs(a,{gap:"300",children:[s.jsx(n,{variant:"headingMd",as:"h2",children:"Environment"}),s.jsxs(n,{as:"p",children:[s.jsx("strong",{children:"Shop:"})," ",m]}),s.jsxs(n,{as:"p",children:[s.jsx("strong",{children:"SHOPIFY_BUNDLE_DISCOUNT_ID:"})," ",S]})]})}),s.jsx(t,{children:s.jsxs(a,{gap:"300",children:[s.jsxs(n,{variant:"headingMd",as:"h2",children:["Available Shopify Functions (",o.length,")"]}),o.map(e=>s.jsx(d,{padding:"200",background:"bg-surface-secondary",borderRadius:"200",children:s.jsxs(n,{as:"p",children:[s.jsx("strong",{children:e.title})," — apiType: ",e.apiType," — ID: ",s.jsx("code",{children:e.id})]})},e.id))]})}),b.map((e,j)=>{const c=e.validation.issues.length>0,v=!c&&e.db.status==="ACTIVE"&&e.validation.nodeIsActive;return s.jsx(t,{children:s.jsxs(a,{gap:"400",children:[s.jsxs(u,{gap:"300",align:"start",children:[s.jsx(n,{variant:"headingMd",as:"h2",children:e.db.title}),s.jsx(r,{tone:e.db.status==="ACTIVE"?"success":"warning",children:e.db.status}),s.jsx(r,{children:e.db.type}),v&&s.jsx(r,{tone:"success",children:"HEALTHY"}),c&&s.jsx(r,{tone:"critical",children:"ISSUES FOUND"})]}),c&&s.jsx(g,{tone:"critical",title:"Validation Issues",children:s.jsx(a,{gap:"100",children:e.validation.issues.map((I,B)=>s.jsx(n,{as:"p",children:I},B))})}),s.jsx(n,{variant:"headingSm",as:"h3",children:"Database State"}),s.jsx(d,{padding:"200",background:"bg-surface-secondary",borderRadius:"200",children:s.jsx("pre",{style:{fontSize:"12px",whiteSpace:"pre-wrap",wordBreak:"break-all"},children:JSON.stringify(e.db,null,2)})}),s.jsx(n,{variant:"headingSm",as:"h3",children:"Shopify Discount Node"}),s.jsx(d,{padding:"200",background:"bg-surface-secondary",borderRadius:"200",children:s.jsx("pre",{style:{fontSize:"12px",whiteSpace:"pre-wrap",wordBreak:"break-all"},children:JSON.stringify(e.shopify,null,2)})}),s.jsx(n,{variant:"headingSm",as:"h3",children:"Validation Summary"}),s.jsx(d,{padding:"200",background:"bg-surface-secondary",borderRadius:"200",children:s.jsx("pre",{style:{fontSize:"12px",whiteSpace:"pre-wrap",wordBreak:"break-all"},children:JSON.stringify(e.validation,null,2)})})]})},e.db.id)})]})]})}export{H as default};
