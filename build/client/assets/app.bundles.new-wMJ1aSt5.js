import{r as o,j as e}from"./index-BXFZJKZ8.js";import{u as pe,S as A,R as W,T as O,a as L,d as he,g as me,v as ge}from"./volume-brackets-BsJ0wB5Q.js";import{a as xe,b as be,c as ye,d as je}from"./components-B2MXwJ-S.js";import{P as fe,B as l,C as T,T as a,a as C,I as X,b as v}from"./Page-D9pdNdHS.js";import{T as Te}from"./TitleBar-DFMSJ8Yc.js";import{L as N}from"./Layout-BW6TgK73.js";import{C as k}from"./EmptySearchResult-B5Jp3ieX.js";import{B as H}from"./Banner-BiM8hRvP.js";import"./context-BusKBsRw.js";import"./banner-context-RZ1829w2.js";function Pe(){const P=pe(),Q=xe(),U=be(),G=ye(),x=je(),[q,$]=o.useState(""),[d,J]=o.useState("FBT"),[b,z]=o.useState("PERCENTAGE"),[w,K]=o.useState(""),[D,Y]=o.useState(!0),[R,Z]=o.useState(!0),[F,ee]=o.useState(!0),[S,te]=o.useState([]),[_,se]=o.useState("3"),[y,ne]=o.useState([]),[r,g]=o.useState([{quantity:"2",uncapped:!0,discountType:"PERCENTAGE",discountValue:"10"}]),V=G.state==="submitting",E=x,ae=E==null?void 0:E.tierErrors,[ie,j]=o.useState([]),f=ae??ie,oe=f&&f.length>0,re=()=>{if(d==="VOLUME"){const t=ge(r);if(t.length>0){j(t);return}j([])}ce()},ce=()=>{const t=new FormData;t.append("title",q),d==="VOLUME"?t.append("tiers",JSON.stringify(r)):(t.append("discountType",b),t.append("discountValue",w)),d==="MIX_MATCH"&&t.append("targetQuantity",_),t.append("type",d),t.append("stacksWithProductDiscounts",D.toString()),t.append("stacksWithOrderDiscounts",R.toString()),t.append("stacksWithShippingDiscounts",F.toString()),S.forEach(n=>{t.append("productIds[]",n.id)}),y.forEach(n=>{t.append("collectionIds[]",n.id)}),Q(t,{method:"post"})},le=async()=>{const t=await P.resourcePicker({type:"product",multiple:!0,selectionIds:S.map(n=>({id:n.id}))});t&&te(t)},de=async()=>{const t=await P.resourcePicker({type:"collection",multiple:!0,selectionIds:y.map(n=>({id:n.id}))});t&&ne(t)};return e.jsxs(fe,{backAction:{content:"Bundles",onAction:()=>U("/app")},title:"Create new bundle",children:[e.jsx(Te,{title:"Create new bundle",children:e.jsx("button",{variant:"primary",onClick:()=>re(),disabled:V,children:V?"Saving...":"Save bundle"})}),e.jsx(l,{gap:"500",children:e.jsxs(N,{children:[e.jsx(N.Section,{children:e.jsxs(l,{gap:"500",children:[e.jsx(T,{children:e.jsxs(l,{gap:"400",children:[e.jsx(a,{variant:"headingMd",as:"h2",children:"Bundle details"}),(x==null?void 0:x.error)&&e.jsx(a,{tone:"critical",as:"p",children:x.error}),e.jsx(C,{label:"Bundle title",value:q,onChange:$,autoComplete:"off",helpText:"Internal name for your reference."}),e.jsx(A,{label:"Bundle type",options:[{label:"Frequently Bought Together (FBT)",value:"FBT"},{label:"Volume Pricing (Quantity Breaks)",value:"VOLUME"},{label:"Mix & Match",value:"MIX_MATCH"},{label:"Classic Bundle",value:"CLASSIC"}],value:d,onChange:J}),d==="MIX_MATCH"&&e.jsx(C,{label:"Required Items (Target Quantity)",type:"number",value:_,onChange:se,autoComplete:"off",helpText:"How many items must the customer choose from the pool below to unlock the deal?"})]})}),e.jsx(T,{children:e.jsxs(l,{gap:"400",children:[e.jsx(a,{variant:"headingMd",as:"h2",children:"Products & Collections"}),S.length>0?e.jsx(W,{resourceName:{singular:"product",plural:"products"},items:S,renderItem:t=>{var h,u;const{id:n,title:m,images:c}=t,s=e.jsx(O,{source:((h=c[0])==null?void 0:h.originalSrc)||"https://cdn.shopify.com/s/files/1/0533/2089/files/placeholder-images-image_large.png",alt:((u=c[0])==null?void 0:u.altText)||m});return e.jsx(L,{id:n,media:s,onClick:()=>{},children:e.jsx(a,{variant:"bodyMd",fontWeight:"bold",as:"h3",children:m})})}}):e.jsx(a,{as:"p",tone:"subdued",children:"No products selected."}),d==="MIX_MATCH"&&y.length>0&&e.jsx(W,{resourceName:{singular:"collection",plural:"collections"},items:y,renderItem:t=>{const{id:n,title:m,image:c}=t,s=e.jsx(O,{source:(c==null?void 0:c.originalSrc)||"https://cdn.shopify.com/s/files/1/0533/2089/files/placeholder-images-image_large.png",alt:(c==null?void 0:c.altText)||m});return e.jsx(L,{id:n,media:s,onClick:()=>{},children:e.jsxs(a,{variant:"bodyMd",fontWeight:"bold",as:"h3",children:[m," (Collection)"]})})}}),d==="MIX_MATCH"&&y.length===0&&e.jsx(a,{as:"p",tone:"subdued",children:"No collections selected."}),e.jsxs(X,{gap:"300",children:[e.jsx(v,{onClick:le,children:"Select products"}),d==="MIX_MATCH"&&e.jsx(v,{onClick:de,children:"Select collections"})]})]})}),e.jsx(T,{children:e.jsxs(l,{gap:"400",children:[e.jsx(a,{variant:"headingMd",as:"h2",children:"Combinations"}),e.jsxs(l,{gap:"200",children:[e.jsx(k,{label:"Product discounts",checked:D,onChange:Y}),e.jsx(k,{label:"Order discounts",checked:R,onChange:Z}),e.jsx(k,{label:"Shipping discounts",checked:F,onChange:ee})]}),e.jsx(a,{variant:"bodySm",tone:"subdued",as:"p",children:"Allow this bundle discount to be combined with other product, order, or shipping discounts at checkout."})]})})]})}),e.jsx(N.Section,{variant:"oneThird",children:d!=="VOLUME"?e.jsx(T,{children:e.jsxs(l,{gap:"400",children:[e.jsx(a,{variant:"headingMd",as:"h2",children:"Discount"}),e.jsx(A,{label:"Discount type",options:[{label:"Percentage (%)",value:"PERCENTAGE"},{label:"Fixed amount off",value:"FIXED_AMOUNT"},{label:"Set fixed price",value:"FIXED_PRICE"}],value:b,onChange:z}),e.jsx(C,{label:"Discount value",type:"number",value:w,onChange:K,autoComplete:"off",suffix:b==="PERCENTAGE"?"%":void 0,helpText:b==="FIXED_PRICE"?"The exact total price the customer will pay for all items combined.":b==="FIXED_AMOUNT"?"The exact dollar amount to deduct from the total price of the items.":"The percentage to discount from the total price of the items."})]})}):e.jsx(T,{children:e.jsxs(l,{gap:"400",children:[e.jsx(a,{variant:"headingMd",as:"h2",children:"Volume Tiers"}),e.jsxs(H,{tone:"info",title:"How quantity brackets work",children:[e.jsx("p",{children:"Quantity brackets are set automatically. Enter the minimum quantity for each tier (e.g., 2, 3, 6). Brackets will be: 2-2 items, 3-5 items, 6+ items. Each quantity range gets exactly one discount."}),e.jsx("p",{children:"Example: Buy 2 = 10%, Buy 3-5 = 15%, Buy 6+ = 20%"})]}),oe&&e.jsx(H,{tone:"critical",title:"Fix bracket errors",children:"Quantities must increase (e.g., 2, 3, 6). Check the fields below."}),(()=>{const t=[...r].map((s,h)=>({...s,originalIndex:h})).sort((s,h)=>(parseInt(s.quantity)||0)-(parseInt(h.quantity)||0)),n=t.filter(s=>!isNaN(parseInt(s.quantity))&&parseInt(s.quantity)>=1).map(s=>({quantity:parseInt(s.quantity),uncapped:s.uncapped})),m=he(n),c=new Map(m.map(s=>[s.min,s]));return t.map((s,h)=>{const u=s.originalIndex,I=parseInt(s.quantity),M=!isNaN(I)&&I>=1?c.get(I):null,ue=M?me(M.min,M.max):"—",B=f==null?void 0:f.find(p=>p.index===u);return e.jsxs(l,{gap:"200",children:[e.jsxs(a,{fontWeight:"bold",as:"p",children:["Tier ",h+1]}),e.jsxs(X,{gap:"300",blockAlign:"start",children:[e.jsx(C,{label:"Buy Qty",type:"number",value:s.quantity,onChange:p=>{const i=[...r];i[u].quantity=p,g(i),j([])},autoComplete:"off",helpText:"Minimum quantity for this tier. Must be higher than the tier above.",error:B==null?void 0:B.message}),e.jsxs(l,{gap:"100",children:[e.jsx(a,{as:"p",variant:"bodySm",tone:"subdued",children:"Bracket"}),e.jsx(a,{as:"p",fontWeight:"semibold",children:ue||"—"})]}),e.jsx(C,{label:"Discount",type:"number",value:s.discountValue,onChange:p=>{const i=[...r];i[u].discountValue=p,g(i)},autoComplete:"off",connectedLeft:e.jsx(A,{label:"Type",labelHidden:!0,options:[{label:"%",value:"PERCENTAGE"},{label:"$",value:"FIXED_AMOUNT"}],value:s.discountType,onChange:p=>{const i=[...r];i[u].discountType=p,g(i)}})})]}),h===t.length-1&&e.jsx(k,{label:`Apply this discount to all quantities ${s.quantity||"?"} and above`,helpText:"Recommended for your best discount tier.",checked:s.uncapped??!0,onChange:p=>{const i=[...r];i[u].uncapped=p,g(i)}}),e.jsx(v,{tone:"critical",onClick:()=>{g(r.filter((p,i)=>i!==u)),j([])},children:"Remove Tier"})]},u)})})(),e.jsxs(l,{gap:"100",children:[e.jsx(v,{onClick:()=>{const t=r.length>0?Math.max(...r.map(n=>parseInt(n.quantity)||0),0)+1:2;g([...r,{quantity:String(t),uncapped:!0,discountType:"PERCENTAGE",discountValue:""}]),j([])},children:"Add tier"}),e.jsx(a,{as:"p",variant:"bodySm",tone:"subdued",children:"Add another tier. New tier's minimum must be higher than the last."})]})]})})})]})})]})}export{Pe as default};
